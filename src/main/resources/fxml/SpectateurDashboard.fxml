<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<!--
    Dashboard Spectateur - Mondial 2030
    Interface utilisateur pour achat et gestion de tickets
-->
<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.mondial2030.controller.SpectateurDashboardController"
            styleClass="dashboard-container">
    
    <!-- HEADER -->
    <top>
        <HBox styleClass="header-bar" alignment="CENTER" spacing="20">
            <padding><Insets top="10" right="20" bottom="10" left="20"/></padding>
            
            <HBox alignment="CENTER_LEFT" spacing="10" HBox.hgrow="ALWAYS">
                <Label text="âš½" styleClass="header-logo"/>
                <Label text="MONDIAL 2030" styleClass="header-title"/>
            </HBox>
            
            <!-- Navigation -->
            <HBox spacing="5" styleClass="nav-buttons">
                <Button fx:id="btnAccueil" text="Accueil" styleClass="nav-btn" 
                        onAction="#showAccueil"/>
                <Button fx:id="btnMatchs" text="Matchs" styleClass="nav-btn" 
                        onAction="#showMatchs"/>
                <Button fx:id="btnMesTickets" text="Mes Tickets" styleClass="nav-btn" 
                        onAction="#showMesTickets"/>
                <Button fx:id="btnHistorique" text="Historique" styleClass="nav-btn" 
                        onAction="#showHistorique"/>
                <Button fx:id="btnMesAlertes" text="Mes Alertes" styleClass="nav-btn" 
                        onAction="#showMesAlertes"/>
                <Button fx:id="btnProfil" text="Profil" styleClass="nav-btn" 
                        onAction="#showProfil"/>
            </HBox>
            
            <HBox alignment="CENTER_RIGHT" spacing="15">
                <Label fx:id="lblUserName" text="Utilisateur" styleClass="user-name-header"/>
                <Button text="DÃ©connexion" styleClass="btn-logout-header" 
                        onAction="#handleDeconnexionSpectateur"/>
            </HBox>
            
        </HBox>
    </top>
    
    <!-- CONTENU PRINCIPAL -->
    <center>
        <StackPane fx:id="contentPane" styleClass="content-area-spectateur">
            
            <!-- ===== ACCUEIL ===== -->
            <VBox fx:id="accueilPane" spacing="30" styleClass="content-pane-spectateur">
                <padding><Insets top="30" right="40" bottom="30" left="40"/></padding>
                
                <VBox alignment="CENTER" spacing="10">
                    <Label fx:id="lblWelcome" text="Bienvenue !" styleClass="welcome-title"/>
                    <Label text="RÃ©servez vos places pour la Coupe du Monde 2030" 
                           styleClass="welcome-subtitle"/>
                </VBox>
                
                <!-- Cartes info -->
                <HBox spacing="30" alignment="CENTER">
                    <VBox styleClass="info-card" alignment="CENTER" spacing="10">
                        <Label text="ðŸŽ«" styleClass="info-icon"/>
                        <Label text="Mes Tickets" styleClass="info-title"/>
                        <Label fx:id="lblNbTickets" text="0 ticket(s)" styleClass="info-value"/>
                        <Button text="Voir mes tickets" styleClass="btn-outline-small" 
                                onAction="#showMesTickets"/>
                    </VBox>
                    
                    <VBox fx:id="prochainMatchCard" styleClass="info-card, highlight-card" 
                          alignment="CENTER" spacing="10">
                        <Label text="âš½" styleClass="info-icon"/>
                        <Label text="Prochain Match" styleClass="info-title"/>
                        <Label fx:id="lblProchainMatch" text="Aucun match" 
                               styleClass="info-value" wrapText="true" textAlignment="CENTER"/>
                        <Button text="Voir les matchs" styleClass="btn-primary-small" 
                                onAction="#showMatchs"/>
                    </VBox>
                </HBox>
                
                <!-- Matchs Ã  venir -->
                <VBox spacing="15" VBox.vgrow="ALWAYS">
                    <Label text="Matchs Ã  venir" styleClass="section-title"/>
                    <ListView fx:id="listMatchsAVenir" styleClass="match-list" VBox.vgrow="ALWAYS"/>
                </VBox>
                
            </VBox>
            
            <!-- ===== LISTE DES MATCHS ===== -->
            <VBox fx:id="matchsPane" spacing="20" styleClass="content-pane-spectateur" 
                  visible="false" managed="false">
                <padding><Insets top="20" right="30" bottom="20" left="30"/></padding>
                
                <Label text="Matchs disponibles" styleClass="page-title-spectateur"/>
                
                <!-- Filtres -->
                <HBox spacing="15" styleClass="filter-bar-spectateur" alignment="CENTER_LEFT">
                    <TextField fx:id="txtSearchMatch" promptText="ðŸ” Rechercher Ã©quipe, stade, ville..." 
                               styleClass="search-field" prefWidth="300"/>
                    <ComboBox fx:id="cmbFilterPhase" promptText="Phase" prefWidth="150"/>
                    <DatePicker fx:id="dpFilterDate" promptText="Date" prefWidth="150"/>
                    <Button text="Filtrer" styleClass="btn-secondary" onAction="#handleFilterMatchs"/>
                    <Button text="RÃ©initialiser" styleClass="btn-outline" onAction="#handleResetFilters"/>
                </HBox>
                
                <Label text="Double-cliquez sur un match pour voir les dÃ©tails et acheter des tickets" 
                       styleClass="hint-text"/>
                
                <!-- Tableau -->
                <TableView fx:id="tableMatchs" VBox.vgrow="ALWAYS" styleClass="table-custom">
                    <columns>
                        <TableColumn fx:id="colMatchEquipes" text="Match" prefWidth="250"/>
                        <TableColumn fx:id="colMatchDate" text="Date/Heure" prefWidth="150"/>
                        <TableColumn fx:id="colMatchStade" text="Stade" prefWidth="180"/>
                        <TableColumn fx:id="colMatchPhase" text="Phase" prefWidth="150"/>
                        <TableColumn fx:id="colMatchDisponibilite" text="DisponibilitÃ©" prefWidth="120"/>
                    </columns>
                </TableView>
                
            </VBox>
            
            <!-- ===== DÃ‰TAIL MATCH ET ACHAT ===== -->
            <VBox fx:id="detailMatchPane" spacing="20" styleClass="content-pane-spectateur" 
                  visible="false" managed="false">
                <padding><Insets top="20" right="30" bottom="20" left="30"/></padding>
                
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Button text="â† Retour" styleClass="btn-back" onAction="#handleRetourMatchs"/>
                    <Label text="DÃ©tails du match" styleClass="page-title-spectateur"/>
                </HBox>
                
                <!-- Infos match -->
                <HBox spacing="30" alignment="CENTER" styleClass="match-detail-header">
                    <VBox alignment="CENTER" spacing="5">
                        <ImageView fx:id="imgEquipeDomicile" fitWidth="80" fitHeight="80"/>
                    </VBox>
                    <VBox alignment="CENTER" spacing="5">
                        <Label fx:id="lblDetailEquipes" text="" styleClass="match-teams"/>
                        <Label fx:id="lblDetailDate" text="" styleClass="match-date"/>
                        <Label fx:id="lblDetailStade" text="" styleClass="match-venue"/>
                        <HBox spacing="10" alignment="CENTER">
                            <Label fx:id="lblDetailPhase" text="" styleClass="match-phase-badge"/>
                            <Label fx:id="lblDetailGroupe" text="" styleClass="match-group-badge"/>
                        </HBox>
                    </VBox>
                    <VBox alignment="CENTER" spacing="5">
                        <ImageView fx:id="imgEquipeExterieur" fitWidth="80" fitHeight="80"/>
                    </VBox>
                </HBox>
                
                <!-- SÃ©lection zone et achat -->
                <HBox spacing="30" VBox.vgrow="ALWAYS">
                    <!-- Zones disponibles -->
                    <VBox spacing="10" HBox.hgrow="ALWAYS">
                        <Label text="Zones disponibles" styleClass="section-title"/>
                        <TableView fx:id="tableZones" VBox.vgrow="ALWAYS" styleClass="table-custom">
                            <columns>
                                <TableColumn fx:id="colZoneNom" text="Zone" prefWidth="120"/>
                                <TableColumn fx:id="colZoneType" text="Type" prefWidth="100"/>
                                <TableColumn fx:id="colZoneCapacite" text="CapacitÃ©" prefWidth="80"/>
                                <TableColumn fx:id="colZoneDisponible" text="Dispo." prefWidth="80"/>
                                <TableColumn fx:id="colZonePrix" text="Prix" prefWidth="100"/>
                            </columns>
                        </TableView>
                    </VBox>
                    
                    <!-- Panneau d'achat -->
                    <VBox spacing="15" styleClass="purchase-panel" minWidth="320" prefWidth="350">
                        <Label text="Acheter des tickets" styleClass="section-title" wrapText="true"/>
                        
                        <VBox spacing="8">
                            <Label text="CatÃ©gorie" styleClass="field-label"/>
                            <ComboBox fx:id="cmbCategorie" maxWidth="Infinity" prefHeight="40"/>
                        </VBox>
                        
                        <VBox spacing="8">
                            <Label text="QuantitÃ©" styleClass="field-label"/>
                            <Spinner fx:id="spinnerQuantite" maxWidth="Infinity" prefHeight="40"/>
                        </VBox>
                        
                        <Separator/>
                        
                        <HBox alignment="CENTER" spacing="15">
                            <Label text="Prix total :" styleClass="price-label"/>
                            <Label fx:id="lblPrixTotal" text="-- â‚¬" styleClass="price-value"/>
                        </HBox>
                        
                        <Button text="ðŸ›’ Acheter" styleClass="btn-purchase" 
                                maxWidth="Infinity" prefHeight="50" onAction="#handleAcheterTicket"/>
                    </VBox>
                </HBox>
                
            </VBox>
            
            <!-- ===== MES TICKETS ===== -->
            <VBox fx:id="mesTicketsPane" spacing="20" styleClass="content-pane-spectateur" 
                  visible="false" managed="false">
                <padding><Insets top="20" right="30" bottom="20" left="30"/></padding>
                
                <Label text="Mes Tickets" styleClass="page-title-spectateur"/>
                
                <HBox spacing="30" VBox.vgrow="ALWAYS">
                    <!-- Liste des tickets -->
                    <VBox spacing="10" HBox.hgrow="ALWAYS">
                        <TableView fx:id="tableMesTickets" VBox.vgrow="ALWAYS" styleClass="table-custom">
                            <columns>
                                <TableColumn fx:id="colTicketCode" text="Code" prefWidth="120"/>
                                <TableColumn fx:id="colTicketMatch" text="Match" prefWidth="180"/>
                                <TableColumn fx:id="colTicketDate" text="Date" prefWidth="130"/>
                                <TableColumn fx:id="colTicketZone" text="Zone" prefWidth="100"/>
                                <TableColumn fx:id="colTicketSiege" text="SiÃ¨ge" prefWidth="80"/>
                                <TableColumn fx:id="colTicketStatut" text="Statut" prefWidth="90"/>
                            </columns>
                        </TableView>
                        
                        <!-- Actions -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button text="ï¿½ PDF" styleClass="btn-primary" 
                                    onAction="#handleDownloadTicketPdf"/>
                            <Button text="ï¿½ðŸ“¤ TransfÃ©rer" styleClass="btn-secondary" 
                                    onAction="#handleTransfererTicket"/>
                            <Button text="âŒ Annuler" styleClass="btn-danger" 
                                    onAction="#handleAnnulerTicket"/>
                        </HBox>
                    </VBox>
                    
                    <!-- DÃ©tails ticket et QR -->
                    <VBox spacing="0" styleClass="ticket-card" prefWidth="320" alignment="CENTER">
                        <!-- En-tÃªte du ticket -->
                        <HBox styleClass="ticket-header" alignment="CENTER" spacing="10">
                            <Label text="ðŸŽ«" style="-fx-font-size: 24px;"/>
                            <Label text="MONDIAL 2030" styleClass="ticket-header-title"/>
                        </HBox>
                        
                        <!-- QR Code centrÃ© -->
                        <VBox alignment="CENTER" styleClass="ticket-qr-section">
                            <ImageView fx:id="imgQRCode" fitWidth="180" fitHeight="180" preserveRatio="true"/>
                            <Label fx:id="lblTicketCode" text="" styleClass="ticket-code"/>
                        </VBox>
                        
                        <!-- Ligne de perforation -->
                        <HBox styleClass="ticket-perforation" alignment="CENTER">
                            <Label text="âœ‚ Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· Â· âœ‚" style="-fx-text-fill: #999;"/>
                        </HBox>
                        
                        <!-- DÃ©tails du match -->
                        <VBox spacing="8" styleClass="ticket-info-section" alignment="CENTER_LEFT">
                            <HBox spacing="10" alignment="CENTER">
                                <Label fx:id="lblTicketEquipes" text="" styleClass="ticket-match-title"/>
                            </HBox>
                            
                            <HBox spacing="15">
                                <VBox spacing="3">
                                    <Label text="ðŸ“… Date" styleClass="ticket-label"/>
                                    <Label fx:id="lblTicketDate" text="" styleClass="ticket-value"/>
                                </VBox>
                                <VBox spacing="3">
                                    <Label text="ðŸŸï¸ Stade" styleClass="ticket-label"/>
                                    <Label fx:id="lblTicketStade" text="" styleClass="ticket-value"/>
                                </VBox>
                            </HBox>
                            
                            <HBox spacing="15">
                                <VBox spacing="3">
                                    <Label text="ðŸ“ Zone" styleClass="ticket-label"/>
                                    <Label fx:id="lblTicketZone" text="" styleClass="ticket-value"/>
                                </VBox>
                                <VBox spacing="3">
                                    <Label text="ðŸŽ« CatÃ©gorie" styleClass="ticket-label"/>
                                    <Label fx:id="lblTicketCategorie" text="" styleClass="ticket-value"/>
                                </VBox>
                            </HBox>
                            
                            <HBox spacing="15" alignment="CENTER_LEFT">
                                <VBox spacing="3">
                                    <Label text="ðŸ’° Prix" styleClass="ticket-label"/>
                                    <Label fx:id="lblTicketPrix" text="" styleClass="ticket-price"/>
                                </VBox>
                                <VBox spacing="3">
                                    <Label text="âœ… Statut" styleClass="ticket-label"/>
                                    <Label fx:id="lblTicketStatut" text="" styleClass="ticket-status"/>
                                </VBox>
                            </HBox>
                        </VBox>
                        
                        <!-- Pied du ticket -->
                        <HBox styleClass="ticket-footer" alignment="CENTER">
                            <Label text="PrÃ©sentez ce QR code Ã  l'entrÃ©e" styleClass="ticket-footer-text"/>
                        </HBox>
                        
                        <!-- Bouton tÃ©lÃ©chargement PDF -->
                        <HBox alignment="CENTER" style="-fx-padding: 15 0 10 0;">
                            <Button fx:id="btnDownloadPdf" text="ðŸ“¥ TÃ©lÃ©charger PDF" 
                                    styleClass="btn-download-pdf" onAction="#handleDownloadTicketPdf"/>
                        </HBox>
                        
                        <!-- Ancien label pour compatibilitÃ© (cachÃ©) -->
                        <Label fx:id="lblTicketDetails" visible="false" managed="false"/>
                    </VBox>
                </HBox>
                
            </VBox>
            
            <!-- ===== HISTORIQUE ===== -->
            <VBox fx:id="historiquePane" spacing="20" styleClass="content-pane-spectateur" 
                  visible="false" managed="false">
                <padding><Insets top="20" right="30" bottom="20" left="30"/></padding>
                
                <Label text="Historique des transactions" styleClass="page-title-spectateur"/>
                
                <TableView fx:id="tableHistorique" VBox.vgrow="ALWAYS" styleClass="table-custom">
                    <columns>
                        <TableColumn fx:id="colHistDate" text="Date" prefWidth="150"/>
                        <TableColumn fx:id="colHistType" text="Type" prefWidth="120"/>
                        <TableColumn fx:id="colHistMontant" text="Montant" prefWidth="120"/>
                        <TableColumn fx:id="colHistStatut" text="Statut" prefWidth="120"/>
                        <TableColumn fx:id="colHistReference" text="RÃ©fÃ©rence" prefWidth="200"/>
                    </columns>
                </TableView>
                
            </VBox>
            
            <!-- ===== PROFIL ===== -->
            <VBox fx:id="profilPane" spacing="20" styleClass="content-pane-spectateur" 
                  visible="false" managed="false">
                <padding><Insets top="20" right="30" bottom="20" left="30"/></padding>
                
                <Label text="Mon Profil" styleClass="page-title-spectateur"/>
                
                <HBox spacing="40">
                    <!-- Informations personnelles -->
                    <VBox spacing="15" styleClass="profile-section" HBox.hgrow="ALWAYS">
                        <Label text="Informations personnelles" styleClass="section-title"/>
                        
                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Nom"/>
                                <TextField fx:id="txtProfilNom" styleClass="text-field-custom"/>
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="PrÃ©nom"/>
                                <TextField fx:id="txtProfilPrenom" styleClass="text-field-custom"/>
                            </VBox>
                        </HBox>
                        
                        <VBox spacing="5">
                            <Label text="Email"/>
                            <TextField fx:id="txtProfilEmail" styleClass="text-field-custom" 
                                       editable="false" disable="true"/>
                        </VBox>
                        
                        <VBox spacing="5">
                            <Label text="TÃ©lÃ©phone"/>
                            <TextField fx:id="txtProfilTelephone" styleClass="text-field-custom"/>
                        </VBox>
                        
                        <Button text="Sauvegarder" styleClass="btn-primary" 
                                onAction="#handleSauvegarderProfil"/>
                    </VBox>
                    
                    <!-- Changement mot de passe -->
                    <VBox spacing="15" styleClass="profile-section" prefWidth="350">
                        <Label text="Changer le mot de passe" styleClass="section-title"/>
                        
                        <VBox spacing="5">
                            <Label text="Ancien mot de passe"/>
                            <PasswordField fx:id="txtOldPassword" styleClass="text-field-custom"/>
                        </VBox>
                        
                        <VBox spacing="5">
                            <Label text="Nouveau mot de passe"/>
                            <PasswordField fx:id="txtNewPassword" styleClass="text-field-custom"/>
                        </VBox>
                        
                        <VBox spacing="5">
                            <Label text="Confirmer"/>
                            <PasswordField fx:id="txtConfirmPassword" styleClass="text-field-custom"/>
                        </VBox>
                        
                        <Button text="Modifier le mot de passe" styleClass="btn-secondary" 
                                onAction="#handleChangerMotDePasse"/>
                    </VBox>
                </HBox>
                
            </VBox>
            
            <!-- ===== MES ALERTES ===== -->
            <VBox fx:id="mesAlertesPane" spacing="20" styleClass="content-pane-spectateur" 
                  visible="false" managed="false">
                <padding><Insets top="20" right="30" bottom="20" left="30"/></padding>
                
                <HBox alignment="CENTER_LEFT" spacing="20">
                    <Label text="Mes Alertes et Signalements" styleClass="page-title-spectateur" HBox.hgrow="ALWAYS"/>
                    <Button text="+ Nouvelle alerte" styleClass="btn-primary" 
                            onAction="#handleNouvelleAlerte"/>
                </HBox>
                
                <Label text="Soumettez vos questions, signalements ou demandes d'assistance. L'Ã©quipe administrative vous rÃ©pondra dans les plus brefs dÃ©lais." 
                       styleClass="hint-text" wrapText="true"/>
                
                <!-- Tableau des alertes -->
                <TableView fx:id="tableMesAlertes" VBox.vgrow="ALWAYS" styleClass="table-custom">
                    <columns>
                        <TableColumn fx:id="colMesAlertesDate" text="Date" prefWidth="130"/>
                        <TableColumn fx:id="colMesAlertesTitre" text="Titre" prefWidth="200"/>
                        <TableColumn fx:id="colMesAlertesType" text="Type" prefWidth="150"/>
                        <TableColumn fx:id="colMesAlertesStatut" text="Statut" prefWidth="100"/>
                        <TableColumn fx:id="colMesAlertesReponse" text="RÃ©ponse Admin" prefWidth="250"/>
                    </columns>
                </TableView>
                
                <!-- DÃ©tail de l'alerte sÃ©lectionnÃ©e -->
                <VBox fx:id="detailAlertePane" spacing="10" styleClass="info-card" visible="false" managed="false">
                    <Label text="DÃ©tail de l'alerte" styleClass="section-title"/>
                    <HBox spacing="15">
                        <VBox spacing="3" HBox.hgrow="ALWAYS">
                            <Label text="Votre message:" styleClass="field-label"/>
                            <Label fx:id="lblDetailMessage" wrapText="true" styleClass="detail-text"/>
                        </VBox>
                    </HBox>
                    <HBox spacing="15" fx:id="reponseAdminBox" visible="false" managed="false">
                        <VBox spacing="3" HBox.hgrow="ALWAYS">
                            <Label text="RÃ©ponse de l'administrateur:" styleClass="field-label"/>
                            <Label fx:id="lblReponseAdmin" wrapText="true" styleClass="detail-text-admin"/>
                            <Label fx:id="lblDateReponse" styleClass="hint-text"/>
                        </VBox>
                    </HBox>
                </VBox>
                
            </VBox>
            
        </StackPane>
    </center>
    
    <!-- FOOTER -->
    <bottom>
        <HBox styleClass="footer-bar" alignment="CENTER">
            <padding><Insets top="10" right="20" bottom="10" left="20"/></padding>
            <Label text="Â© 2024 Mondial 2030 - Plateforme de Gestion des Tickets" 
                   styleClass="footer-text"/>
        </HBox>
    </bottom>
    
</BorderPane>
